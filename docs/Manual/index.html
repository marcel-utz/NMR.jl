<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>User Manual · NMR.jl</title><meta name="title" content="User Manual · NMR.jl"/><meta property="og:title" content="User Manual · NMR.jl"/><meta property="twitter:title" content="User Manual · NMR.jl"/><meta name="description" content="Documentation for NMR.jl."/><meta property="og:description" content="Documentation for NMR.jl."/><meta property="twitter:description" content="Documentation for NMR.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">NMR.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li class="is-active"><a class="tocitem" href>User Manual</a><ul class="internal"><li><a class="tocitem" href="#Getting-started"><span>Getting started</span></a></li><li><a class="tocitem" href="#Loading-NMR-Data"><span>Loading NMR Data</span></a></li><li><a class="tocitem" href="#Phase-Correction"><span>Phase Correction</span></a></li><li><a class="tocitem" href="#Cutting-Regions"><span>Cutting Regions</span></a></li><li><a class="tocitem" href="#Computing-Integrals"><span>Computing Integrals</span></a></li><li><a class="tocitem" href="#Baseline-Correction"><span>Baseline Correction</span></a></li><li><a class="tocitem" href="#Detecting-Peaks"><span>Detecting Peaks</span></a></li></ul></li><li><a class="tocitem" href="../NMR-1.0/">Roadmap to Version 1.0</a></li><li><a class="tocitem" href="../Reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>User Manual</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>User Manual</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/marcel-utz/NMR.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/marcel-utz/NMR.jl/blob/master/docs/src/Manual.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="User-Manual"><a class="docs-heading-anchor" href="#User-Manual">User Manual</a><a id="User-Manual-1"></a><a class="docs-heading-anchor-permalink" href="#User-Manual" title="Permalink"></a></h1><h2 id="Getting-started"><a class="docs-heading-anchor" href="#Getting-started">Getting started</a><a id="Getting-started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-started" title="Permalink"></a></h2><p><code>NMR.jl</code> is a Julia package. It is installed using the Julia package management system:</p><pre><code class="language- hljs">import Pkg
Pkg.add(url=&quot;https://github.com/marcel-utz/NMR.jl&quot;)</code></pre><p>Once the install finishes, you are ready to go.</p><h2 id="Loading-NMR-Data"><a class="docs-heading-anchor" href="#Loading-NMR-Data">Loading NMR Data</a><a id="Loading-NMR-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-NMR-Data" title="Permalink"></a></h2><p>To start processing, you need to load some NMR data. There are commands to load raw data from various spectrometer vendors. Typically, the data is loaded raw. This means that only the time-domain spectral data is returned, and you have to manually convert it to a data object that can be further processed.</p><p>The <code>NMR.jl</code> comes with example data that can be used to play with its functions. The data can be found through a dictionary in the module <code>Examples</code>:</p><pre><code class="language-julia hljs">import NMR
import NMR.Examples

data=Examples.Data[&quot;HCC cell culture media spectra&quot;]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Any} with 9 entries:
  &quot;name&quot;        =&gt; &quot;HCC cell culture media spectra&quot;
  &quot;format&quot;      =&gt; &quot;Bruker&quot;
  &quot;author&quot;      =&gt; &quot;Evie Rogers&quot;
  &quot;files&quot;       =&gt; [&quot;/home/mu3q/Source/NMR.jl/src/../examples/2023-07-29 HCC cu…
  &quot;reference&quot;   =&gt; &quot;unpublished&quot;
  &quot;doi&quot;         =&gt; &quot;&quot;
  &quot;tags&quot;        =&gt; [&quot;microfluidic NMR&quot;, &quot;cells&quot;, &quot;metabolomics&quot;]
  &quot;description&quot; =&gt; &quot;^1H NMR experiments obtained from the supernatant of HCC ce…
  &quot;path&quot;        =&gt; &quot;/home/mu3q/Source/NMR.jl/src/../examples/2023-07-29 HCC cul…</code></pre><h3 id="Bruker-data"><a class="docs-heading-anchor" href="#Bruker-data">Bruker data</a><a id="Bruker-data-1"></a><a class="docs-heading-anchor-permalink" href="#Bruker-data" title="Permalink"></a></h3><p>We can read raw data from an &quot;fid&quot; file in this set as follows:</p><pre><code class="language-julia hljs">f=NMR.readBrukerFID(data[&quot;files&quot;][1]*&quot;/fid&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">32768-element Vector{ComplexF64}:
     131.203125 - 181.21875im
    -496.359375 + 908.015625im
    431.1171875 - 274.828125im
       -706.625 + 1392.2265625im
    1086.328125 - 1282.7421875im
   -1474.546875 + 2338.7421875im
    2038.015625 - 2740.5im
  -2732.1015625 + 4055.1171875im
   3593.5078125 - 5045.671875im
    -4740.96875 + 6741.3984375im
                ⋮
 -283007.765625 - 183694.90625im
    -420138.875 + 79240.765625im
    -175130.375 + 254453.578125im
  -25309.578125 + 487678.984375im
            0.0 + 0.0im
            0.0 + 0.0im
            0.0 + 0.0im
            0.0 + 0.0im
            0.0 + 0.0im</code></pre><p><code>f</code>returns an array with the complex data points contained in the  <code>fid</code> file. To convert this to useable time-domain data,  you need to convert it into a <code>Data1D</code> object. </p><p>Bruker NMR systems store the acquisition parameters in a separate file, which we can read into a Julia dictionary as follows:</p><pre><code class="language-julia hljs">acqus=NMR.readBrukerParameterFile(data[&quot;files&quot;][1]*&quot;/acqus&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, Any} with 235 entries:
  &quot;O4&quot;       =&gt; 4323.3
  &quot;PCPD&quot;     =&gt; [0, 80, 0, 0, 0, 0, 0, 0, 0, 0]
  &quot;PLWMAX&quot;   =&gt; Real[137.28, 0, 0, 0, 0, 0, 0, 0]
  &quot;PQSCALE&quot;  =&gt; 1
  &quot;TE&quot;       =&gt; 298.0
  &quot;FQ5LIST&quot;  =&gt; &quot;&lt;&gt;&quot;
  &quot;RECPRE&quot;   =&gt; [-1, 0, -1, -1, -1, -1, -1, -1, -1, -1  …  -1, -1, -1, -1, -1, …
  &quot;VPLIST&quot;   =&gt; &quot;&lt;&gt;&quot;
  &quot;VCLIST&quot;   =&gt; &quot;&lt;&gt;&quot;
  &quot;O7&quot;       =&gt; 4323.3
  &quot;FL3&quot;      =&gt; 0
  &quot;FQ6LIST&quot;  =&gt; &quot;&lt;&gt;&quot;
  &quot;SW_h&quot;     =&gt; 13888.9
  &quot;DATATYPE&quot; =&gt; &quot;Parameter Values&quot;
  &quot;RSEL&quot;     =&gt; [0, 1, 0, 0, 0, 0, 0, 0, 0, 0  …  0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
  &quot;CNST&quot;     =&gt; [1, 1, 1, 1, 1, 1, 1, 1, 1, 1  …  1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
  &quot;USERA4&quot;   =&gt; &quot;&lt;&gt;&quot;
  &quot;YMAX_a&quot;   =&gt; 6.494e8
  &quot;SPOFFS&quot;   =&gt; [0, 0, 0, 0, 0, 0, 0, 0, 0, 0  …  0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
  ⋮          =&gt; ⋮</code></pre><p>To convert the raw fid data into a <code>Data1D</code> object which we can process,  we need some of these parameters. The time step between subsequent points in the FID is given by the inverse of the spectral width. Moreover, Bruker FIDs actually begin <em>before</em> <span>$t=0$</span> due to the  group delay of the digital filter. The number of  points to remove is found in the <code>acqus</code> parameter <code>&quot;GRPDLY&quot;</code>:</p><pre><code class="language-julia hljs">dwellTime=1/acqus[&quot;SW_h&quot;]
f=f[acqus[&quot;GRPDLY&quot;]:end]
d=NMR.Data1D(f,0.0,length(f)*dwellTime)
NMR.plot(real(d))</code></pre><p><img src="../plot-fid.svg" alt/></p><p>To convert the time-domain data into a spectrum, we use <code>NMR.FourierTransform</code>. By default, FourierTransform interprets the time domain in the <code>Data1D</code> object in seconds, and produces another <code>Data1D</code> object with a horizontal axis in Hz:</p><pre><code class="language-julia hljs">import Plots
spect=NMR.FourierTransform(d)
Plots.plot(real(spect),xaxis=:flip,xlabel=&quot;frequency [Hz]&quot;)</code></pre><p><img src="../plot-spec.svg" alt/></p><p>To obtain a spectrum with a horizontal axis in ppm chemical shift, we have  to indicate the conversion. This is done by giving the number of Hz per ppm  as a parameter. In our case, the spectrum was acquired on a 700 MHz spectrometer. One ppm therefore corresponds to 700 Hz. The precise factor is contained in the Bruker parameter <code>&quot;SFO1&quot;</code>. Also, we can calibrate the horizontal axis by indicating the chemical shift at the centre of the spectrum:</p><pre><code class="language-julia hljs">import Plots
spect=NMR.FourierTransform(d,PPM=acqus[&quot;SFO1&quot;],CTR=4.76)
Plots.plot(real(spect),xaxis=:flip,xlabel=&quot;1H Chem. Shift [ppm]&quot;)</code></pre><p><img src="../plot-specHz.svg" alt/></p><h3 id="JEOL-data"><a class="docs-heading-anchor" href="#JEOL-data">JEOL data</a><a id="JEOL-data-1"></a><a class="docs-heading-anchor-permalink" href="#JEOL-data" title="Permalink"></a></h3><p>We can also import data from a JEOL spectrometer. In this case, the parameters and the data are combined in the same (binary) file. JEOL <code>.jdf</code> files have a rather elaborate structure. Fortunately, there is a function that parses this, and returns the parameters as a dictionary, as well as the raw data:</p><pre><code class="language-julia hljs">import NMR
import NMR.Examples

data=Examples.Data[&quot;DMEM cell culture medium&quot;]
s=open(data[&quot;files&quot;][1])
header,params,data = NMR.readJEOL(s)
close(s)
Plots.plot(data)</code></pre><p><img src="../plot-JEOL-raw.svg" alt/></p><h2 id="Phase-Correction"><a class="docs-heading-anchor" href="#Phase-Correction">Phase Correction</a><a id="Phase-Correction-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Correction" title="Permalink"></a></h2><p>The above spectrum still shows artefacts. To clean it up, we need to correct the phase. This can either be done manually, by supplying <code>PH0</code>and <code>PH1</code> arguments to <code>FourierTransform</code>, or we can resort to automatic phase correction:</p><pre><code class="language-julia hljs">spect = NMR.AutoPhaseCorrectChen(spect)
Plots.plot(real(spect),xaxis=:flip,xlabel=&quot;1H Chem. Shift [ppm]&quot;)</code></pre><p><img src="../plot-specHz-ap.svg" alt/></p><h2 id="Cutting-Regions"><a class="docs-heading-anchor" href="#Cutting-Regions">Cutting Regions</a><a id="Cutting-Regions-1"></a><a class="docs-heading-anchor-permalink" href="#Cutting-Regions" title="Permalink"></a></h2><p>The above spectrum covers a wide range without any signals, which is of no interest. We can chop out the central, important part:</p><pre><code class="language-julia hljs">s2=NMR.cut(spect,-0.5,9.0)
Plots.plot(real(s2),xaxis=:flip,xlabel=&quot;1H Chem. Shift [ppm]&quot;)</code></pre><p><img src="../plot-S2.svg" alt/></p><h2 id="Computing-Integrals"><a class="docs-heading-anchor" href="#Computing-Integrals">Computing Integrals</a><a id="Computing-Integrals-1"></a><a class="docs-heading-anchor-permalink" href="#Computing-Integrals" title="Permalink"></a></h2><p>In Chemistry, it is customary to show the integral of the spectral signal along with the spectrum. This makes the intensity of the peaks directly visible as a step height for each signal. The integrated spectrum can be computed like this:</p><pre><code class="language-julia hljs">intSpect = NMR.integrate(s2)
Plots.plot(real(s2),xaxis=:flip,xlabel=&quot;1H Chem. Shift [ppm]&quot;,label=&quot;spectrum&quot;)
Plots.plot!(20*intSpect,label=&quot;integral&quot;)</code></pre><p><img src="../plot-S3.svg" alt/></p><h2 id="Baseline-Correction"><a class="docs-heading-anchor" href="#Baseline-Correction">Baseline Correction</a><a id="Baseline-Correction-1"></a><a class="docs-heading-anchor-permalink" href="#Baseline-Correction" title="Permalink"></a></h2><p>In the above plot, it can be seen that the integral line has regions where it decreases from left to right. This results from corresponding regions in the spectrum that have negative baseline intensity. The baseline of the NMR spectrum, while visually quite acceptable, is numerically not perfectly adjusted. The baseline of the real part of the spectrum can be computed as follows:</p><pre><code class="language-julia hljs">Plots.plot(s2,xaxis=:flip)
Plots.plot!(NMR.medianBaseline(real(s2),wdw=512),linewidth=4.0,ylims=2.0e9*[-1,10])</code></pre><p><img src="../plot-S4.svg" alt/></p><p>With this baseline is subtracted from the spectrum before integration, a much cleaner integral curve is obtained:</p><pre><code class="language-julia hljs">spectBc = real(s2)-NMR.medianBaseline(real(s2),wdw=512)
Plots.plot(spectBc,xaxis=:flip,ylims=2e10*[-1,10])
intSpect = NMR.integrate(spectBc,flip=true)
Plots.plot!(10*intSpect)</code></pre><p><img src="../plot-S5.svg" alt/></p><h2 id="Detecting-Peaks"><a class="docs-heading-anchor" href="#Detecting-Peaks">Detecting Peaks</a><a id="Detecting-Peaks-1"></a><a class="docs-heading-anchor-permalink" href="#Detecting-Peaks" title="Permalink"></a></h2><p>The locations, heights, and widths of the peaks in the spectrum can be automatically detected using the <code>NMR.peaks()</code> function. It returns a data structure that contains all relevant information:</p><pre><code class="language-julia hljs">pks=NMR.peaks(spectBc,threshold=1e2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PeakStruct([-0.013390495920547191, 0.9050500015175211, 0.9157166733135865, 0.9280895586509302, 0.9379282818327753, 0.9387168071449545, 0.9479888079237633, 0.959484443293366, 0.9697302744458136, 0.9813868176572192  …  4.7938998694371175, 5.226641514223148, 5.213020031395467, 6.8663612897095225, 6.877976787967351, 7.162967922143303, 7.174654431271209, 7.301276183119267, 7.3957620749061315, 7.406999212271634], [1.2634969653876194e10, 2.0783060304255419e9, 4.211546883692296e9, 5.348080794117154e9, 6.439053116946153e9, 6.308215425134834e9, 4.1107969824668627e9, 2.542922530732429e9, 2.3340089709982004e9, 4.020844283262091e9  …  3.3255284471601787e9, 4.059039275235201e10, 2.3180342718135704e10, 9.137871016998763e8, 8.793567847486898e8, 8.377016256850219e8, 7.901835463702574e8, 8.068457330573359e8, 9.551278971407121e8, 9.478711479000232e8], [4.006645653039291e14, 9.121148589312069e13, 1.924170757169498e14, 2.0594862183708678e14, 1.9265814790957006e14, 1.7214871477254678e14, 1.3941075345129869e14, 1.0183177618967011e14, 9.909892298535517e13, 1.779941990632124e14  …  2.1424918524207504e13, 9.659288279375612e13, 3.057624659819201e14, 3.679204388553766e13, 3.3681025285649062e13, 3.407116642262975e13, 2.730159484328091e13, 3.2760692236540504e13, 1.8567108583019758e13, 2.2795576841798605e13], [8.497885471475143e10, 3.0184939403199154e8, 1.7751713800885536e10, 2.3588063173694915e8, 4.400354374698629e9, 2.3284274561285122e10, 2.415068293833676e9, 2.995668157154031e9, 6.243393992100966e9, 1.626973601174168e9  …  2.6559157116650975e8, 1.0965673697950223e6, 4.541948394511642e10, 7.772652598241869e8, 1.881669643039539e9, 3.751906312455017e7, 9.666258444921628e8, 5841.857085960222, 5.2689230032930166e8, 3.5912177565391713e8], Data1D{Vector{Float64}, Float64}([14390.515100472363, 14411.361149641018, 14432.275863726396, 14453.259577010282, 14474.312625856275, 14495.435348725516, 14516.62808619253, 14537.891180961064, 14559.224977880318, 14580.629823960939  …  3294.83265352, 3294.0133465244144, 3293.1943761655953, 3292.375742224486, 3291.5574444822632, 3290.739482720332, 3289.9218567203197, 3289.1045662640827, 3288.287611133707, 3287.470991111498], -0.4997389588433103, 8.999708826192686))</code></pre><p>This information can then be used for further analysis, for example for comparison with a database, or for plotting. Here is an example:</p><pre><code class="language-julia hljs">Plots.plot(pks.deconvolution,xaxis=:flip,xlims=[2.9,4.1],ylims=6.0e11*[-1,10],label=&quot;deconvolution&quot;,yaxis=false,grid=false,legend=Symbol(:outer,:bottomright),minorticks=true,xlabel=&quot;1H Chem. Shift [ppm]&quot;)
Plots.plot!(spectBc+2.0e12,label=&quot;spectrum&quot;)
Plots.plot!(pks.positions,5.5e12*ones(length(pks.positions)),seriestype=:scatter,marker=:vline,label=&quot;peaks&quot;)</code></pre><p><img src="../plot-S6.svg" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Overview</a><a class="docs-footer-nextpage" href="../NMR-1.0/">Roadmap to Version 1.0 »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Monday 3 February 2025 15:07">Monday 3 February 2025</span>. Using Julia version 1.10.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
